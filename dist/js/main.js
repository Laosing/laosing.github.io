"use strict";!function(e){(new function(){var t=this,i=e("#checkout"),o=e(".main"),n=e("body"),a=e(".work"),l=e(".close"),c=e(".side"),s=(e(".load"),e(".helper")),r=e(".about");function f(t,i){t=t?"hidden":"",i.length>1?e(i).each(function(e,i){i.css({overflow:t})}):e(i).css({overflow:t})}this.timelineArray=null,this.workArray=null,this.json=null,this.init=function(){this.setHtml(),i.click(function(e){e.preventDefault(),t.open()}),l.add(".bg").click(function(e){e.preventDefault(),t.close()}),e("#about-me").click(function(e){e.preventDefault(),t.aboutOpen()}),e(".about-close").click(function(e){e.preventDefault(),t.aboutClose()}),e(document).keydown(function(e){27==e.keyCode&&(n.hasClass("open-about")?t.aboutClose():n.hasClass("open-work")&&t.close())})},this.open=function(){e(".bg").show(),n.addClass("open-work");var i=this.checkMobile()?"-100%":"-30%";o.velocity({left:i},"normal","ease",function(){l.velocity("fadeIn","fast"),t.checkMobile()||a.velocity("fadeIn","normal")})},this.close=function(){if(e(".bg").hide(),this.checkMobile()&&a.hasClass("open"))return this.hide(0),void a.velocity("fadeOut").removeClass("open");n.hasClass("open-work")&&(n.removeClass("open-work"),a.velocity("fadeOut","normal",function(){o.velocity({left:""},"normal","ease",function(){e("#work-container li.active").removeClass("active").removeAttr("style").hide(),e(".active").removeClass("active"),s.removeAttr("style"),a.removeClass("open")})}),l.velocity("fadeOut","fast"))},this.aboutOpen=function(){f(!0,[n,r]),n.addClass("open-about"),this.checkMobile()?r.velocity({scale:1},0).velocity("fadeIn",function(){f(!1,e(this))}):(c.velocity({opacity:1},{display:"none",duration:0}),o.velocity({scale:.9},function(){r.show().velocity({opacity:1},"linear",function(){f(!1,r)})}))},this.aboutClose=function(){f(!0,[n,r]),n.hasClass("open-about")&&(n.removeClass("open-about"),this.checkMobile()?r.velocity("fadeOut",function(){n.removeAttr("style")}):r.velocity({opacity:0},{easing:"linear",display:"none",complete:function(){o.velocity({scale:1},"linear",function(){c.velocity({opacity:1},{display:"block"}),n.removeAttr("style")})}}))},this.checkMobile=function(e){return!!Modernizr.mq("only screen and (max-width: 600px)")&&("function"==typeof e&&e(),!0)},this.setHtml=function(){e.getJSON("./data/portfolio.json").done(function(i){t.json=i;var o=e("#work-template").html(),n=Handlebars.compile(o);e("#work-container").html(n(i));var a=e("#list-template").html(),l=Handlebars.compile(a);e("#timeline").html(l(i))}).done(function(){t.timelineArray=e("#timeline li"),t.workArray=e("#work-container li"),t.setLogic(),e(".work-piece").each(function(t){e(this).find("img.lazy:first").lazyload({event:"first"+t})})})},this.setLogic=function(){function i(t){e("img.lazy").trigger("first"+t)}this.timelineArray.length,this.timelineArray.each(function(o,n){var a,l=e(t.workArray[o]);e(n).click(function(){t.mainLogic(l,e(this)),i(o)}),(a=l).find("img.lazy").lazyload({effect:"fadeIn",container:a})}),e(".next").click(function(o){o.preventDefault(),t.nextLogic(e(this));var n=e(this).closest(".work-piece").data("work");i(n=n<=t.workArray.length-1?n+1:0)}),e(".prev").click(function(o){o.preventDefault(),t.prevLogic(e(this));var n=e(this).closest(".work-piece").data("work");i(n=0===n?t.workArray.length-1:n-1)})},this.prevLogic=function(i){var o=(i=i.closest(".work-piece")).data("work"),n=i.prev(),a=t.timelineArray.length-1,l=0!==o?o-1:t.workArray.length-1,c=e(e("#timeline li")[l]);0===o&&(n=e('#work-container li[data-work="'+a+'"]')),t.prev(n,c)},this.nextLogic=function(i){var o=(i=i.closest(".work-piece")).data("work"),n=i.next(),a=o<t.workArray.length-1?o+1:0,l=e(e("#timeline li")[a]);o===t.workArray.length-1&&(n=e('#work-container li[data-work="0"]')),t.next(n,l)},this.mainLogic=function(i,o){i.hasClass("active")||e(".velocity-animating").length||(e(".active").length?this.next(i,o):s.velocity("fadeOut","fast",function(){t.show(i,o)}),this.checkMobile()&&a.velocity("fadeIn"))},this.show=function(e,t){e.addClass("active"),t.addClass("active"),a.addClass("open"),e.show().velocity({left:"0",display:"block"},"normal","ease")},this.hide=function(t,i){e("#work-container .active").velocity({left:t,opacity:0},"normal","ease",function(){e(".active").removeAttr("style").removeClass("active"),e(this).hide(),"function"==typeof i&&i()})},this.next=function(e,i){t.hide("-200%",function(){e.addClass("active"),i.addClass("active"),a.addClass("open"),e.show().velocity({left:"0"},"normal","ease")})},this.prev=function(e,i){t.hide("100%",function(){e.addClass("active"),i.addClass("active"),e.velocity({left:"-200%"},0).show().velocity({left:"0"},"normal","ease")})}}).init()}(jQuery);