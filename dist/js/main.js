"use strict";(new function(){var s=this,t=$(".main"),n=$("body"),l=$(".work"),i=$(".close"),e=$(".side"),r=$(".helper"),o=$(".about"),f=$("#work-container"),u=$("#timeline"),a=$(".bg");function c(i,e){i=i?"hidden":"",1<e.length?$(e).each(function(e,t){t.css({overflow:i})}):$(e).css({overflow:i})}this.init=function(){var o=document.title;page("*",function(e,t){var i=e.path.split("/"),n=i[i.length-1]?"Drew Rattana | "+i[i.length-1].replace(/-/g," ").toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" "):o;document.title=n,ga("set","page",e.path),ga("send","pageview"),t()}),page("/",function(){s.aboutClose(),s.close()}),page("/about",function(){s.close(),s.aboutOpen()}),page("/work",function(){s.aboutClose(),s.checkMobile()?s.close():s.hide(0),n.hasClass("open-work")||s.open()}),page("/work/:title",function(i){s.aboutClose();var e=u.find("li[data-timeline-title="+i.params.title+"]");n.hasClass("open-work")&&e.hasClass("active")||s.open(function(){var e=u.find("li[data-timeline-title="+i.params.title+"]"),t=f.find("li[data-work-title="+i.params.title+"]");s.next("next",t,e),r.removeClass("helper-active")})}),page({hashbang:!0}),$("#checkout").click(function(e){e.preventDefault(),page("/work")}),i.add(a).click(function(e){e.preventDefault(),s.checkMobile()&&l.hasClass("open")?page("/work"):page("/")}),$("#about-me").click(function(e){e.preventDefault(),page("/about")}),$(".about-close").click(function(e){e.preventDefault(),page("/")}),$(document).keydown(function(e){27==e.keyCode&&(n.hasClass("open-about")||n.hasClass("open-work"))&&page("/")});var c=tippy("[title]");tippy.browser.onUserInputChange=function(e){var t="touch"===e?"disable":"enable",i=!0,n=!1,o=void 0;try{for(var a,l=c.tooltips[Symbol.iterator]();!(i=(a=l.next()).done);i=!0)a.value[t]()}catch(e){n=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw o}}},window.addEventListener("scroll",function(){var e=!0,t=!1,i=void 0;try{for(var n,o=document.querySelectorAll(".tippy-popper")[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value._tippy;a.state.visible&&(a.popperInstance.disableEventListeners(),a.hide())}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}),$(".backtotop").on("click",function(e){e.preventDefault();var t=$(this).parents(".work-piece.active");$(this).velocity("scroll",{container:t,duration:2e3,offset:-t[0].scrollHeight,easing:"easeInOutCubic"})})},this.open=function(e){s.checkMobile()||a.show(),n.hasClass("open-work")?"function"==typeof e&&e():(n.addClass("open-work"),r.addClass("helper-active"),t.velocity({left:this.checkMobile()?"-100%":"-30%"},"normal","ease",function(){i.velocity("fadeIn","fast"),s.checkMobile()||l.velocity("fadeIn","normal"),"function"==typeof e&&e()}))},this.close=function(){if(a.velocity("fadeOut",function(){$(this).removeAttr("style")}),this.checkMobile()&&l.hasClass("open"))return s.hide(0),void l.velocity("fadeOut").removeClass("open");n.hasClass("open-work")&&(n.removeClass("open-work"),l.velocity("fadeOut","normal",function(){t.velocity({left:""},"normal","ease",function(){f.find("li.active").removeClass("active").removeAttr("style").hide(),$(".active").removeClass("active"),r.removeAttr("style"),l.removeClass("open")})}),i.velocity("fadeOut","fast"))},this.aboutOpen=function(){c(!0,[n,o]),n.addClass("open-about"),this.checkMobile()?o.velocity({scale:1},0).velocity("fadeIn",function(){c(!1,$(this))}):(e.velocity({opacity:1},{display:"none",duration:0}),t.velocity({scale:.9},function(){o.show().velocity({opacity:1},"linear",function(){c(!1,o)})}))},this.aboutClose=function(){c(!0,[n,o]),n.hasClass("open-about")&&(n.removeClass("open-about"),this.checkMobile()?o.velocity("fadeOut",function(){n.removeAttr("style")}):o.velocity({opacity:0},{easing:"linear",display:"none",complete:function(){t.velocity({scale:1},"linear",function(){e.velocity({opacity:1},{display:"block"}),n.removeAttr("style")})}}))},this.checkMobile=function(){return!!Modernizr.mq("only screen and (max-width: 600px)")},this.setHtml=function(){$.getJSON("./data/portfolio.json").fail(function(){alert("Sorry, this site is currently down. Please blame the developer and try again later. :(")}).done(function(e){s.json=e,Handlebars.registerHelper("hyphencase",function(e){return e.replace(/\W+/g,"-").toLowerCase()});var t=$("#work-template").html(),i=Handlebars.compile(t);f.html(i(e));var n=$("#list-template").html(),o=Handlebars.compile(n);u.html(o(e))}).done(function(){s.timelineArray=u.find("li"),s.workArray=f.find("li"),s.setLogic(),$(".work-piece").each(function(e){$(this).find("img.lazy:first").lazyload({event:"first"+e})})}).done(function(){s.init()})},this.setLogic=function(){this.timelineArray.length,this.timelineArray.each(function(e,t){var i=$(s.workArray[e]);i.find("img.lazy").lazyload({effect:"fadeIn",container:i}),$(t).click(function(){$(".velocity-animating").length||s.next("next",i,$(this),!0)})}),$(".next").click(function(e){e.preventDefault(),s.nextLogic($(this),"next")}),$(".prev").click(function(e){e.preventDefault(),s.nextLogic($(this),"prev")})},this.nextLogic=function(e,t){var i=(e=e.closest(".work-piece")).data("work"),n=s.timelineArray.length-1,o="next"===t?e.next():e.prev(),a=i<s.workArray.length-1?i+1:0,l=0!==i?i-1:s.workArray.length-1,c="next"===t?a:l,r=$(u.find("li")[c]);"next"===t&&i===s.workArray.length-1&&(o=f.find('li[data-work="0"]')),"prev"===t&&0===i&&(o=f.find('li[data-work="'+n+'"]')),s.next(t,o,r,!0)},this.hide=function(e,t){f.find(".active").velocity({left:e,opacity:1},"normal","ease",function(){$(".active").removeAttr("style").removeClass("active"),$(this).hide(),"function"==typeof t&&t()})},this.next=function(e,t,i,n){if(!t.hasClass("active"))if(this.checkMobile()&&(l.velocity("fadeIn",{duration:0}),r.hide()),t.find("img.lazy:first-child").trigger("first"+t.data("work")),$(".active").length){var o="next"===e?"-200%":"100%";s.hide(o,a)}else a();function a(){t.addClass("active"),i.addClass("active"),l.addClass("open"),"prev"===e&&t.velocity({left:"-200%"},0),t.show().velocity({left:0},"normal","ease",function(){n&&page("/work/"+t.data("work-title"))})}}}).setHtml();