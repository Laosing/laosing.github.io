"use strict";(new function(){var e=this,t=$("#checkout"),i=$(".main"),o=$("body"),n=$(".work"),a=$(".close"),l=$(".side"),c=($(".load"),$(".helper")),s=$(".about");function r(e,t){e=e?"hidden":"",t.length>1?$(t).each(function(t,i){i.css({overflow:e})}):$(t).css({overflow:e})}this.timelineArray=null,this.workArray=null,this.json=null,this.init=function(){page("/",function(){e.aboutClose(),e.close()}),page("/about",function(){e.close(),e.aboutOpen()}),page("/work",function(){e.aboutClose(),e.hide(0),e.open()}),page("/work/:title",function(t,i){e.aboutClose();var n=$("#timeline").find("li[data-timeline-title="+t.params.title+"]");o.hasClass("open-work")&&n.hasClass("active")||e.open(function(){var i=$("#timeline").find("li[data-timeline-title="+t.params.title+"]"),o=$("#work-container").find("li[data-work-title="+t.params.title+"]");o.data("work"),e.mainLogic(o,i)})}),page({hashbang:!0}),t.click(function(e){e.preventDefault(),page("/work")}),a.add(".bg").click(function(e){e.preventDefault(),page("/")}),$("#about-me").click(function(e){e.preventDefault(),page("/about")}),$(".about-close").click(function(e){e.preventDefault(),page("/")}),$(document).keydown(function(e){27==e.keyCode&&(o.hasClass("open-about")||o.hasClass("open-work"))&&page("/")})},this.open=function(t){$(".bg").show(),o.addClass("open-work");var l=this.checkMobile()?"-100%":"-30%";i.velocity({left:l},"normal","ease",function(){a.velocity("fadeIn","fast"),e.checkMobile()||(n.velocity("fadeIn","normal"),"function"==typeof t&&t())})},this.close=function(){if($(".bg").hide(),this.checkMobile()&&n.hasClass("open"))return this.hide(0),void n.velocity("fadeOut").removeClass("open");o.hasClass("open-work")&&(o.removeClass("open-work"),n.velocity("fadeOut","normal",function(){i.velocity({left:""},"normal","ease",function(){$("#work-container li.active").removeClass("active").removeAttr("style").hide(),$(".active").removeClass("active"),c.removeAttr("style"),n.removeClass("open")})}),a.velocity("fadeOut","fast"))},this.aboutOpen=function(){r(!0,[o,s]),o.addClass("open-about"),this.checkMobile()?s.velocity({scale:1},0).velocity("fadeIn",function(){r(!1,$(this))}):(l.velocity({opacity:1},{display:"none",duration:0}),i.velocity({scale:.9},function(){s.show().velocity({opacity:1},"linear",function(){r(!1,s)})}))},this.aboutClose=function(){r(!0,[o,s]),o.hasClass("open-about")&&(o.removeClass("open-about"),this.checkMobile()?s.velocity("fadeOut",function(){o.removeAttr("style")}):s.velocity({opacity:0},{easing:"linear",display:"none",complete:function(){i.velocity({scale:1},"linear",function(){l.velocity({opacity:1},{display:"block"}),o.removeAttr("style")})}}))},this.checkMobile=function(e){return!!Modernizr.mq("only screen and (max-width: 600px)")&&("function"==typeof e&&e(),!0)},this.setHtml=function(){$.getJSON("./data/portfolio.json").done(function(t){e.json=t,Handlebars.registerHelper("hyphencase",function(e){return e.replace(/\W+/g,"-").toLowerCase()});var i=$("#work-template").html(),o=Handlebars.compile(i);$("#work-container").html(o(t));var n=$("#list-template").html(),a=Handlebars.compile(n);$("#timeline").html(a(t))}).done(function(){e.timelineArray=$("#timeline li"),e.workArray=$("#work-container li"),e.setLogic(),$(".work-piece").each(function(e){$(this).find("img.lazy:first").lazyload({event:"first"+e})})}).done(function(){e.init()})},this.setLogic=function(){this.timelineArray.length,this.timelineArray.each(function(t,i){var o=$(e.workArray[t]);o.find("img.lazy").lazyload({effect:"fadeIn",container:o}),$(i).click(function(){var t=$(this).data("timeline-title");e.mainLogic(o,$(this),t)})}),$(".next").click(function(t){t.preventDefault(),e.nextLogic($(this));var i=$(this).closest(".work-piece").data("work");i=i<=e.workArray.length-1?i+1:0}),$(".prev").click(function(t){t.preventDefault(),e.prevLogic($(this));var i=$(this).closest(".work-piece").data("work");i=0===i?e.workArray.length-1:i-1})},this.prevLogic=function(t){var i=(t=t.closest(".work-piece")).data("work"),o=t.prev(),n=e.timelineArray.length-1,a=0!==i?i-1:e.workArray.length-1,l=$($("#timeline li")[a]);0===i&&(o=$('#work-container li[data-work="'+n+'"]')),e.prev(o,l)},this.nextLogic=function(t){var i=(t=t.closest(".work-piece")).data("work"),o=t.next(),n=i<e.workArray.length-1?i+1:0,a=$($("#timeline li")[n]);i===e.workArray.length-1&&(o=$('#work-container li[data-work="0"]')),e.next(o,a)},this.mainLogic=function(t,i,o){t.hasClass("active")||($(".active").length?this.next(t,i,o):c.velocity("fadeOut","fast",function(){e.show(t,i,o)}),this.checkMobile()&&n.velocity("fadeIn"))},this.show=function(e,t,i){e.find("img.lazy:first-child").trigger("first"+e.data("work")),e.addClass("active"),t.addClass("active"),n.addClass("open"),e.show().velocity({left:"0",display:"block"},"normal","ease",function(){i&&page("/work/"+i)})},this.hide=function(e,t){$("#work-container .active").velocity({left:e,opacity:0},"normal","ease",function(){$(".active").removeAttr("style").removeClass("active"),$(this).hide(),"function"==typeof t&&t()})},this.next=function(t,i,o){t.find("img.lazy:first-child").trigger("first"+t.data("work")),e.hide("-200%",function(){t.addClass("active"),i.addClass("active"),n.addClass("open"),t.show().velocity({left:"0"},"normal","ease",function(){o&&page("/work/"+o)})})},this.prev=function(t,i){e.hide("100%",function(){t.addClass("active"),i.addClass("active"),t.velocity({left:"-200%"},0).show().velocity({left:"0"},"normal","ease")})}}).setHtml();